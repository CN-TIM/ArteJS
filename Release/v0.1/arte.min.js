!function(a){a.Arte=a.Arte||{},a.fn.Arte=function(b,c){var d=[];return rangy.init(),this.each(function(){var e=a(this),f=e.data("Arte");if(b&&"string"==typeof b){var g=b;if(this.constructor===a.Arte.TextArea&&(f=this),!f)throw"This is not a rich text field.";var h=f[g].call(f,c);d.push(h)}else f||(b=b||{},b.element=this,f=new a.Arte.TextArea(b),e.data("Arte",f)),d.push(f)}),a(d)}}(jQuery);
!function(){var a=$.Arte.constants,b=$.Arte.configuration,c=a.commandAttrType,d=function(a,d){var e=b.commands[a];if(e.commandAttrType)return e.commandAttrType;var f=b.commandAttrType;return d?(d.commandAttrType?f=d.commandAttrType:d.styleName?f=c.styleName:d.className?f=c.className:d.tagName&&(f=c.tagName),f):f},e=function(b,c){var d=h.call(this,b,c);d.execute=!0,this.triggerEvent(a.eventNames.onbeforecommand,d),d.execute&&(delete d.execute,$.Arte.RichTextCommandApplier.createAndExecute(d),this.triggerEvent(a.eventNames.oncommand,d))},f=function(a,d,e){if(e&&d===c.styleName&&e.styleValue)return e.styleValue;if(e&&d===c.className&&e.className)return e.className;if(e&&e.commandValue)return e.commandValue;if("string"==typeof e)return e;var f=b.commands[a].defaultValue;return f?f[d]:void 0},g=function(c,d,e){if(e&&e.tagName)return e.tagName;var f=b.commands[c];return f.applierTagName?$.isPlainObject(f.applierTagName)?f.applierTagName[d]:f.applierTagName:f.tagName?f.tagName:f.commandType===a.commandType.inline?b.defaultInlineTag:b.defaultBlockTag},h=function(c,e){var h=d(c,e),i=b.commands[c],j={textArea:this,commandAttrType:h,commandName:c,tagName:i.tagName,applierTagName:g(c,h,e)},k=f(c,h,e);switch(h){case a.commandAttrType.className:j.classNameRegex=i.classNameRegex,j.className=k;break;case a.commandAttrType.styleName:j.styleName=i.styleName,j.styleValue=k}return $.extend(e,j)};$.extend($.Arte.TextArea.prototype,{bold:function(a){e.apply(this,["bold",a])},italic:function(a){e.apply(this,["italic",a])},underline:function(a){e.apply(this,["underline",a])},blockquote:function(){e.apply(this,["blockquote"])},h1:function(){e.apply(this,["h1"])},h2:function(){e.apply(this,["h2"])},h3:function(){e.apply(this,["h3"])},h4:function(){e.apply(this,["h4"])},h5:function(){e.apply(this,["h5"])},h6:function(){e.apply(this,["h6"])},subscript:function(){e.apply(this,["subscript"])},superscript:function(){e.apply(this,["superscript"])},fontSize:function(a){e.apply(this,["fontSize",a])},fontFamily:function(a){e.apply(this,["fontFamily",a])},color:function(a){e.apply(this,["color",a])},backgroundColor:function(a){e.apply(this,["backgroundColor",a])},unorderedList:function(a){e.apply(this,["unorderedList",a])},orderedList:function(a){e.apply(this,["orderedList",a])},textAlign:function(a){e.apply(this,["textAlign",a])},toggleStyleOnElement:function(a){var b=a.element||this.$el;if(a&&a.styleName){var c=$.Arte.dom.getStyles(b);a.styleValue===c[a.styleName]&&(a.styleValue=""),b.css(a.styleName,a.styleValue)}if(a&&a.className){var d=b.hasClass(a.className)?"removeClass":"addClass";b[d](a.className)}}})}();
!function(a){a.Arte=a.Arte||{},a.Arte.constants={editorTypes:{richText:"richText",plainText:"plainText"},commandType:{inline:"inline",block:"block",complex:"complex",other:"other"},commandAttrType:{tagName:"tagName",styleName:"styleName",className:"className",other:"other"},nodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,COMMENT:8},tagName:{LI:"LI",OL:"OL",UL:"UL",BR:"BR",DIV:"DIV",SPAN:"SPAN",P:"P",B:"B",I:"I",U:"U",STRONG:"STRONG",SUB:"SUB",SUP:"SUP",BLOCKQUOTE:"BLOCKQUOTE",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6"},eventNames:{onfocus:"onfocus",onblur:"onblur",onvaluechange:"onvaluechange",onmousedown:"onmousedown",onmouseup:"onmouseup",onclick:"onclick",onkeydown:"onkeydown",onkeypress:"onkeypress",onkeyup:"onkeyup",onpaste:"onpaste",onselectionchange:"onselectionchange",onbeforecommand:"onbeforecommand",oncommand:"oncommand",oncreate:"oncreate",ondestroy:"ondestroy"}};var b=a.Arte.constants;a.Arte.configuration={allowOpsOnCollapsedSelection:!0,classNameSpace:"arte",styleableTags:{SPAN:1,DIV:1,P:1,LI:1,UL:1,OL:1},mergableTags:{SPAN:{SPAN:1,DIV:1,P:1,LI:1},DIV:{DIV:1,P:1,LI:1},P:{DIV:1,P:1,LI:1},LI:{},OL:{},UL:{},B:{B:1},U:{U:1},I:{I:1},STRONG:{STRONG:1},SUB:{SUB:1},SUP:{SUP:1},H1:{H2:1,H3:1,H4:1,H5:1,H6:1},H2:{H1:1,H3:1,H4:1,H5:1,H6:1},H3:{H1:1,H2:1,H4:1,H5:1,H6:1},H4:{H1:1,H2:1,H3:1,H5:1,H6:1},H5:{H1:1,H2:1,H3:1,H4:1,H6:1},H6:{H1:1,H2:1,H3:1,H4:1,H5:1}},commandAttrType:b.commandAttrType.styleName,textFieldIdentifier:"rteTextField",rangySelectionBoundaryClassName:"rangySelectionBoundary",defaultInlineTag:b.tagName.SPAN,defaultBlockTag:b.tagName.P},a.Arte.configuration.initialValues={styles:{"min-height":"200px",height:"inherit"},classes:[],pollIntervalInMs:350,value:"Please enter text ..."};var c=a.Arte.configuration;a.Arte.configuration.commands={bold:{commandType:b.commandType.inline,tagName:b.tagName.B,styleName:"font-weight",classNameRegex:new RegExp(c.classNameSpace+"-font-weight-[\\S]+"),defaultValue:{styleName:"bold",className:c.classNameSpace+"-font-weight-bold"},applierTagName:{tagName:b.tagName.B,className:b.tagName.SPAN,styleName:b.tagName.SPAN}},italic:{tagName:b.tagName.I,applierTagName:{tagName:b.tagName.I,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"font-style",classNameRegex:new RegExp(c.classNameSpace+"-font-style-italic"),commandType:b.commandType.inline,defaultValue:{styleName:"italic",className:c.classNameSpace+"-font-style-italic"}},underline:{tagName:b.tagName.U,applierTagName:{tagName:b.tagName.U,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"text-decoration",classNameRegex:new RegExp(c.classNameSpace+"-text-decoration-[\\S]+"),commandType:b.commandType.inline,defaultValue:{styleName:"underline",className:c.classNameSpace+"-text-decoration-underline"}},blockquote:{tagName:b.tagName.BLOCKQUOTE,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h1:{tagName:b.tagName.H1,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h2:{tagName:b.tagName.H2,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h3:{tagName:b.tagName.H3,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h4:{tagName:b.tagName.H4,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h5:{tagName:b.tagName.H5,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h6:{tagName:b.tagName.H6,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},orderedList:{tagName:b.tagName.OL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},unorderedList:{tagName:b.tagName.UL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},subscript:{tagName:b.tagName.SUB,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},superscript:{tagName:b.tagName.SUP,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},_li:{tagName:b.tagName.LI,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},insert:{tagName:b.tagName.SPAN,commandType:b.commandType.other,commandAttrType:b.commandAttrType.other},fontSize:{styleName:"font-size",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-size-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline},fontFamily:{styleName:"font-family",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-family-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline},color:{styleName:"color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline},backgroundColor:{styleName:"background-color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-background-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline},textAlign:{styleName:"text-align",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-text-align-[\\S]+"),applierTagName:b.tagName.P,commandType:b.commandType.block}},function(){a.each(c.commands,function(a,b){b.commandName=a})}(),a.Arte.configuration.commands.getCommandConfig=function(d){var e=null,f=null;if(d&&d.commandName)return c.commands[d.commandName];for(var g in c.commands){var h=c.commands[g];if(d.className&&h.classNameRegex&&h.classNameRegex.test(d.className))e=h,f=b.commandAttrType.className;else if(d.styleName&&d.styleName===h.styleName)e=h,f=b.commandAttrType.styleName;else if(d.tagName&&!d.className&&!d.styleName){if(a.isPlainObject(h.tagName)){var i=util.any(h.tagName,function(a,b){return b===d.tagName});i&&(e=h)}else d.tagName===h.tagName&&(e=h);f=b.commandAttrType.tagName}if(e)return a.extend({commandAttrType:f},e)}return null}}(jQuery);
!function(a){a.Arte=a.Arte||{},a.Arte.pluginManager={plugins:{},register:function(a,b){this.plugins[a]=b},init:function(a){a.pluginInstances=a.pluginInstances||[];for(var b in this.plugins){var c=new this.plugins[b];c.init(a),a.pluginInstances.push(c)}}}}(jQuery);
!function(a){a.Arte=a.Arte||{},a.Arte.TextArea=function(b){var c=this,d=a.Arte.configuration,e=a.Arte.constants;c.$element=a(b.element),b=a.extend({},d.initialValues,b);var f=e.eventNames;this.editorType=b.editorType||e.editorTypes.richText,this.currentValue="";var g=null,h=function(){g||(g=setInterval(function(){if(c.outerValue()!=c.currentValue){var a=c.outerValue();c.triggerEvent(f.onvaluechange,{newValue:a,oldValue:c.currentValue}),c.currentValue=a}},b.pollIntervalInMs))};0===c.$element.children().length?c.$el=c.editorType===e.editorTypes.richText?a("<div>").attr({contentEditable:"true"}):c.$el=a("<textarea>").css({height:"100%",width:"100%",padding:"0px",border:"0px"}):(c.$el=c.$element.children().first(),c.$el.is("div")&&c.$el.attr({contentEditable:"true"})),c.$el.css(b.styles),a.each(b.classes,function(a,b){c.$el.addClass(b)}),c.$element.append(c.$el),c.$element.attr(d.textFieldIdentifier,"1");var i=!1;c.$el.on({keydown:function(a){c.triggerEvent(f.onkeydown,{originalEvent:a}),a.stopPropagation()},keyup:function(a){c.triggerEvent(f.onkeyup,{originalEvent:a}),a.stopPropagation()},keypress:function(a){c.triggerEvent(f.onkeypress,{originalEvent:a}),a.stopPropagation()},focus:function(a){i||(i=!0,c.triggerEvent(f.onfocus,{originalEvent:a})),h(),a.stopPropagation()},blur:function(a){i=!1,c.triggerEvent(f.onselectionchange),c.triggerEvent(f.onblur,{originalEvent:a}),g&&(clearInterval(g),g=null),a.stopPropagation()},mouseup:function(a){c.triggerEvent(f.onselectionchange),c.triggerEvent(f.onmouseup,{originalEvent:a}),a.stopPropagation()},mousedown:function(a){c.triggerEvent(f.onmousedown,{originalEvent:a}),a.stopPropagation()},click:function(a){c.triggerEvent(f.onclick,{originalEvent:a}),a.stopPropagation(),a.preventDefault()},paste:function(a){setTimeout(function(){c.triggerEvent(f.onpaste,{originalEvent:a})},50)}}),a.Arte.pluginManager.init(c),c.value(b.value),c.currentValue=c.outerValue(),c.$element.on(b.on),c.triggerEvent(f.oncreate)},a.extend(a.Arte.TextArea.prototype,{value:function(b){var c=a.Arte.constants,d=this.editorType===c.editorTypes.richText?"html":"val";return this.currentValue=this.$el[d](),"undefined"==typeof b?this.currentValue:(this.$el[d](b),this.triggerEvent(c.eventNames.onvaluechange,{newValue:b,oldValue:this.currentValue}),void 0)},outerValue:function(b){if("undefined"==typeof b)return this.$element.html();var c=a(b);this.$el.removeAttr("style"),this.$el.attr("style",c.attr("style")),this.$el.removeAttr("class"),this.$el.attr("class",c.attr("class")),this.value(c.html())},focus:function(){var b=this,c=function(){b.$el.off("focus",c),a.Arte.util.moveCursorToEndOfElement(b.$el.get(0))};b.$el.on("focus",c),b.$el.focus()},triggerEvent:function(b,c){this.$element.trigger(b,a.extend(c,{textArea:this}))},destroy:function(){this.$element.removeData("Arte"),this.$element.removeAttr(a.Arte.configuration.textFieldIdentifier),this.$el.off(),this.$el.removeAttr("contentEditable"),this.triggerEvent(a.Arte.constants.eventNames.ondestroy)},on:function(a,b){this.$element.on(a,b)},off:function(a,b){this.$element.off(a,b)}})}(jQuery);
!function(a){a.Arte=a.Arte||{},a.Arte.util={isSelectionInElement:function(a){var b=rangy.getSelection(),c=b.getAllRanges()[0];return c&&(c.startContainer===a.get(0)||0!==a.has(c.startContainer).length)},moveCursorToEndOfElement:function(a){var b=new rangy.createRangyRange;b.selectNodeContents(a),b.collapse();var c=rangy.getSelection();c.setSingleRange(b)},all:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!!d}),d},any:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!d}),d},filterCollection:function(b,c){var d=[];return a.each(b,function(a,e){c(a,e)&&d.push(b.length?e:a)}),d},getSelectedTextNodes:function(b){var c,d=a(),e=rangy.getSelection(),f=a.Arte.util.isSelectionInElement(this.$el);if(e.isCollapsed||!f){if(b&&f)return c=e.getRangeAt(0),d.push(c.startContainer),d;d.push(this.$el.get(0))}else f&&(c=e.getAllRanges()[0],d=rangy.util.getTextNodes(c));return d}}}(jQuery);
!function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b,c=a.Arte.dom,d=a.Arte.configuration,e=a.Arte.constants,f=a.Arte.util,g=function(b){var d=function(b){for(var d=a(b[0]).prop("tagName"),e=function(b,c){return!a(c).is(":emptyTextOrRangySpan")};b.length;){var f=a(b[b.length-1]);b.splice(b.length-1,1);var g=c.prevSiblingIncludingTextNodes(f,e);g&&g.prop("tagName")===d&&(f.children().appendTo(g),f.remove())}};b.each(function(){d(a(this).find(e.tagName.OL)),d(a(this).find(e.tagName.UL))})},h={Next:0,Prev:1},i=function(b,d,e){var f=a(),g=d==h.Next?"nextSiblingIncludingTextNodes":"prevSiblingIncludingTextNodes",i=c[g](b,e);return i.length&&i.is(":element")&&!i.is(":block")&&b.prop("tagName")===i.prop("tagName")&&c.hasSameStyleAndClass(b,i)&&f.push(i[0]),f},j=function(a,b){return i(a,h.Prev,b)},k=function(b){return b.contents().filter(function(b,c){return!a(c).is(":emptyTextOrRangySpan")})},l=function(e){var f=k(e);if(!d.styleableTags[e.prop("tagName")])return!1;var g=f.filter(function(){return a(this).is(":element")});g.each(function(){var g=a(this),h=c.getStyles(g),i=c.getClasses(g);1===f.length?(a.each(h,function(a,b){e.css(a,b),g.css(a,"")}),a.each(i,function(a,b){var g=d.commands.getCommandConfig({className:b});g&&g.classNameRegex&&c.removeClassWithPattern(e,g.classNameRegex),e.addClass(b),f.removeClass(b)})):(a.each(h,function(a,g){var h=d.commands.getCommandConfig({styleName:a}),i={commandName:h.commandName,styleName:a,styleValue:g,topEditableParent:b};c.closestWithCommandValue(f,i).length===f.length&&(e.css(a,g),f.css(a,""))}),a.each(i,function(a,b){if(c.allHaveClass(f,b)){var g=d.commands.getCommandConfig({className:b});g.classNameRegex&&c.removeClassWithPattern(e,g.classNameRegex),e.addClass(b),f.removeClass(b)}}))})},m=function(b){for(var c=k(b),d=1;d<c.length;d++){var e=a(c[d]);if(e.is(":element")&&!e.is(":block")){var f=j(e);f.get(0)&&(f.append(e.contents()),e.remove())}}},n=function(e){var g=k(e),h=g.filter(function(){var b=a(this),c=d.mergableTags[b.prop("tagName")];return b.is(":element")&&(!b.is(":block")||1===g.length)&&c&&c[e.prop("tagName")]});h.each(function(){var e=a(this),g=c.getStyles(e),h=c.getClasses(e),i=f.all(g,function(a,b){var f=d.commands.getCommandConfig({styleName:a}),g=c.closestWithCommand(e.parent(),{commandName:f.commandName,styleName:a});return g.get(0)&&c.getStyles(g)[a]===b}),j=e.parentsUntil(b.parentNode),k=f.all(h,function(a,b){return j.hasClass(b)});return i&&k?(e.contents().first().unwrap(),void 0):void 0})},o=function(e){var g=k(e),h=c.getStyles(e);a.each(h,function(d,h){var i=f.all(g,function(b,e){return c.getStyles(a(e))[d]})||c.closestWithCommandValue(e.parent(),{styleName:d,styleValue:h,topEditableParent:b}).length>0;i&&e.css(d,"")});var i=c.getClasses(e);a.each(i,function(b,h){var i=d.commands.getCommandConfig({className:h}),j=i&&i.classNameRegex&&f.all(g,function(b,d){return c.hasClassWithPattern(a(d),i.classNameRegex)})||e.parents().hasClass(h);j&&e.removeClass(h)})},p=function(b){b.each(function(){var b=a(this);if(b.is(":element")){var c=k(b);p(c),l(b),o(b),m(b),n(b)}})},q=function(b){for(var d=!0,e=function(){var b=a(this);b.is(":block")&&c.nextSiblingIncludingTextNodes(b).length&&c.prevSiblingIncludingTextNodes(b).length&&b.before("<br />"),b.remove()};d;){var f=b.find(":empty").not("br").not(":rangySpan");d=f.length>0,f.each(e)}},r=function(b){b.find("."+d.rangySelectionBoundaryClassName).each(function(){1===a(this).parent().contents().length&&a(this).unwrap()})},s=function(b){var c=a();return b.children().each(function(){var b=a(this);if(s(b),this.tagName===e.tagName.DIV){var d=a("<p>").html(b.html());a.each(["style","id","class"],function(a,c){var e=b.attr(c);e&&d.attr(c,e)}),b.before(d),b.remove(),c.push(d.get(0))}}),c},t=function(a,d){b=d&&d.topEditableParent?d.topEditableParent:c.getTopEditableParent(a).get(0),r(a),q(a,d),g(a),p(a)};c.cleanup=t,c.convertDivsToP=s}(jQuery);
!function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b=a.Arte.dom,c=a.Arte.configuration,d=a.Arte.constants;a.extend(b,{wrapWithOptions:function(d,e){var f=a();if(d.length>0){f=b.createContainer(e);var g=b.prevSiblingIncludingTextNodes(d.first());g.hasClass(c.rangySelectionBoundaryClassName)&&f.append(g);var h=b.nextSiblingIncludingTextNodes(d.last());d.first().before(f),d.each(function(){f.append(this)}),h.hasClass(c.rangySelectionBoundaryClassName)&&f.append(h)}return f},unwrapWithOptions:function(c,d){var e=a();return c.each(function(){var c=a(this),f=function(b,c){return!a(c).is(":emptyTextOrRangySpan")};if(c.is(":block")){var g=b.prevSiblingIncludingTextNodes(c,f);g.length&&!g.is(":block")&&d&&d.insertBr&&c.before(a("<br />"));var h=b.nextSiblingIncludingTextNodes(c,f);h.length&&!h.is(":block")&&d&&d.insertBr&&c.after(a("<br />"))}var i=a(this).contents();if(d&&d.maintainStyles){var j=b.wrapWithOptions(i,{applierTagName:"span",attr:{style:c.attr("style")}});j.unwrap(),e=e.add(j)}else i.first().unwrap(),e=e.add(i)}),e},wrapWithBlock:function(a,e){var f,g=b.closestWithAtMostOneBlockChild(a,e.topEditableParent),h=g.prop("tagName");g.first().is(":block")&&e.applierTagName!==d.tagName.LI&&c.styleableTags[h]?h===e.applierTagName||c.styleableTags[h]&&c.styleableTags[e.applierTagName]?e.styleName?g.css(e.styleName,e.styleValue):e.className?g.addClass(e.className):f=g:f=a:f=g;var i=f?b.wrapWithOptions(f,e):g,j=i.next();return j.length&&j.prop("tagName")==d.tagName.BR&&j.remove(),i},unwrapBlock:function(c,d){var e=b.closestWithCommand(c,d);return e.length?!a.isEmptyObject(b.getStyles(e))||b.getClasses(e).length>0||e.attr("contentEditable")?d.styleName?e.css(d.styleName,""):d.className?e.removeClass(d.className):void 0:b.unwrapWithOptions(e,{insertBr:!0}):c},createContainer:function(b){var c=b.applierTagName||"div",d=a("<"+c+">");return b.attr&&d.attr(b.attr),b.styleName&&b.styleValue&&d.css(b.styleName,b.styleValue),b.className&&d.addClass(b.className),d}})}(jQuery);
!function(a){function b(b,c,d){var e=a(),f=c===g.Next;return b.each(function(){for(var b,c=a(this).parent().contents().get(),g=a.inArray(a(this).get(0),c),h=f?1:-1,i=g+h;f?i<c.length:i>=0;i+=h){var j=d?d(i,c[i]):!0;if(j){b=c[i];break}}b&&e.push(b)}),e}a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var c=a.Arte.dom,d=a.Arte.constants,e=a.Arte.configuration,f=a.Arte.util;a.extend(a.expr[":"],{block:function(b){return 3!==b.nodeType&&(b&&"BR"===b.tagName||("block"===a(b).css("display")||"list-item"===a(b).css("display"))&&"none"===a(b).css("float"))},element:function(a){return a.nodeType===d.nodeType.ELEMENT},emptyText:function(a){return 3===a.nodeType&&null!==a.nodeValue.match(/^\s*$/gi)},rangySpan:function(b){return a(b).hasClass(e.rangySelectionBoundaryClassName)},emptyTextOrRangySpan:function(b){var c=a(b);return c.is(":emptyText")||c.is(":rangySpan")},blockChildren:function(b){return a(b).children().not(this).filter(":block").length>0}});var g={Next:0,Prev:1};document.documentElement.contains&&(jQuery.contains=function(a,b){if(a===b)return!1;if(3===a.nodeType)return!1;var c=b.parentNode||{};return a===c||(1===c.nodeType?!a.contains||a.contains(c):a!==b&&a.contains?a.contains(b):!0)}),a.extend(c,{closestWithAtMostOneBlockChild:function(b,c){var d=[];return b.each(function(){var b=null;a(this).parentsUntil(c).each(function(){var c=a(this).children(":block").length,d=0===c||1===c&&c===this.childNodes.length;return d&&(b=this),d});var e=b||this;-1===a.inArray(e,d)&&d.push(e)}),a(d)},prevSiblingIncludingTextNodes:function(a,c){return b(a,g.Prev,c)},nextSiblingIncludingTextNodes:function(a,c){return b(a,g.Next,c)},getClasses:function(a){var b=[],c=a.attr("class");return c&&(b=c.split(/\s+/)),b},getStyles:function(b){var c={};if(b.prop("nodeType")===d.nodeType.TEXT)return c;var e=b.attr("style"),f=e?e.toLowerCase().split(";"):[];return a.each(f,function(b,d){if(d=a.trim(d),!d)return!0;var e=d.indexOf(":"),f=a.trim(d.substring(0,e)),g=a.trim(d.substring(e+1));g&&(c[f]=g)}),c},hasCommandApplied:function(b,f){var g=!1,h=e.commands[f];return b.each(function(){var b=a(this);if(this.nodeType===d.nodeType.TEXT)return g=!1;var e=c.getStyles(b);return g=h.classNameRegex&&c.hasClassWithPattern(b,h.classNameRegex)||h.styleName&&e[h.styleName]||h.tagName&&this.tagName===h.tagName}),g},hasCommandValue:function(b,d){var e=!1;return b.each(function(){var b=a(this);return e=d.className&&b.hasClass(d.className)||d.styleName&&c.getStyles(b)[d.styleName]===d.styleValue||d.tagName&&b.prop("tagName")===d.tagName}),e},getCommandValue:function(b,d){var f={},g=e.commands[d.commandName];return b.each(function(){var b=a(this),e=c.getStyles(b);return d.className&&b.hasClass(d.className)?f.className=d.className:c.hasClassWithPattern(b,g.classNameRegex)?f.className=c.getClassWithPattern(b,g.classNameRegex)[0]:d.styleName&&e[d.styleName]?f.styleName=e[d.styleName]:d.tagName&&b.prop("tagName")===g.tagName&&(f.tagName=b.prop("tagName")),f}),f},hasClassWithPattern:function(a,b){return b.test(a.attr("class"))},getClassWithPattern:function(a,b){return b.exec(a.attr("class"))},removeClassWithPattern:function(b,d){var e=c.getClassWithPattern(b,d)||[];a.each(e,function(a,c){b.removeClass(c)})},hasSameListParent:function(a){var b=a.first().closest(d.tagName.LI).parent();if(0===b.length)return!1;var c=!0;return a.each(function(){return c=0!==b.has(this).length}),c},allHaveClass:function(b,c){var d=!0;return b.each(function(){return d=a(this).hasClass(c)}),d},hasSameClass:function(b,d){var e={},g={};return a.each(c.getClasses(b),function(){e[this]=1}),a.each(c.getClasses(d),function(){g[this]=1}),f.all(e,function(a){return g[a]})&&f.all(g,function(a){return e[a]})},hasSameStyle:function(a,b){var d=c.getStyles(a),e=c.getStyles(b);return f.all(d,function(a,b){return e[a]===b})&&f.all(e,function(a,b){return d[a]===b})},hasSameStyleAndClass:function(a,b){return c.hasSameStyle(a,b)&&c.hasSameClass(a,b)},closestWithCommandValue:function(b,d){return c.closestWithCommand(b,a.extend(d,{checkValue:1}))},closestWithCommand:function(b,d){var f=a(),g=e.commands.getCommandConfig(d);return g?(b.each(function(){var b=a(this),e=d.topEditableParent||c.getTopEditableParent(b).get(0);if(e){var h=b.parentsUntil(e.parentNode);h.splice(0,0,this),h.each(function(){return c.hasCommandApplied(a(this),g.commandName)?((!d.checkValue||c.hasCommandValue(a(this),d))&&f.push(this),!1):!0})}}),f):f},getTopEditableParent:function(a){return a.closest("[contenteditable=true]")||a.closest("textarea")},listSurrounded:function(b,c){var e=f.all(b,function(b,c){return a(c).closest(d.tagName.LI).parents("[contenteditable=true]").get(0)});if(e){var g=b.closest(d.tagName.LI).parent();if(c&&c.singleList&&g.length>1)return!1;if(c&&c.tagName){var h=!1;return g.each(function(a,b){return h=b.tagName===c.tagName}),h}return!0}return!1}})}(jQuery);
!function(a){var b=function(){var a={insert:function(a){if($.extend(a,{execute:!0}),this.triggerEvent($.Arte.constants.eventNames.onbeforeinsert,a),a.execute){var b=$.Arte.util.isSelectionInElement(this.$el);if(b||$.Arte.configuration.allowOpsOnCollapsedSelection){var c,d=$("<span>").html(a.commandValue).get(0);if(b){c=rangy.getSelection();var e=c.getAllRanges()[0];c.isCollapsed||e.deleteContents(),e.collapse(),e.insertNode(d)}else this.$el.append(d);c=rangy.getSelection(),c.setSingleRange(rangy.util.createRangeFromElements(d,d)),this.triggerEvent($.Arte.constants.eventNames.onafterinsert,a)}}}};return $.extend($.Arte.TextArea.prototype,a),$.extend($.Arte.constants.eventNames,{onbeforeinsert:"onbeforeinsert",onafterinsert:"onafterinsert"}),{init:function(){}}};a.register("insertCommand",b)}($.Arte.pluginManager);
!function(a){var b=$.Arte.constants,c=function(a,b){var c=null,d=!0,e=$.Arte.dom.closestWithCommand(a,b);if(a.length!==e.length)return null;var f=$.Arte.dom.getCommandValue(e.first(),b);if(e.each(function(){return d=$.Arte.dom.hasCommandValue($(this),f)}),d)for(var g in f)c=f[g];return c},d=function(a,c){var d=c.tagName;if(d&&(d===b.tagName.OL||d===b.tagName.UL))return $.Arte.dom.listSurrounded(a,{singleList:!0,tagName:d});var e=$.Arte.dom.closestWithCommandValue(a,c);return e.length===a.length},e=function(a,b,e){if(!a.length)return null;var f=$.Arte.configuration.commands[b],g=$.extend({commandName:b,tagName:f.tagName,styleName:f.styleName,styleValue:f.defaultValue?f.defaultValue.styleName:null,className:f.defaultValue?f.defaultValue.className:null},e);return f.acceptsParams?c(a,g):d(a,g)};$.extend($.Arte.TextArea.prototype,{getState:function(a){var c=$.Arte.util.getSelectedTextNodes.apply(this,[!0]);if(a)return e(c,a);var d={};return $.each($.Arte.configuration.commands,function(a,f){$.isPlainObject(f)&&f.commandType&&f.commandType!=b.commandType.other&&(d[a]=e(c,a))}),d}});var f=function(){return{init:function(){}}};a.register("stateDetector",f)}($.Arte.pluginManager);
!function(a){var b=function(a){var b=a?this.hasUndo():this.hasRedo();if(b){var c=$.Arte.constants.eventNames,d={execute:!0};this.triggerEvent(a?c.onbeforeundo:c.onbeforeredo,d),d.execute&&(this.undoInfo.index+=a?-1:1,this.outerValue(this.undoInfo.stack[this.undoInfo.index])),this.triggerEvent(a?c.onundo:c.onredo,{})}},c=function(a,b){var c=b.textArea,d=c.undoInfo,e=$.trim(c.outerValue());if(e!=d.stack[d.index]){var f=++c.undoInfo.index,g=c.undoInfo.stack;g.splice(f,g.length),g.push(e)}},d={hasUndo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index>0},hasRedo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index<this.undoInfo.stack.length-1},undo:function(){b.call(this,!0)},redo:function(){b.call(this,!1)}};$.extend($.Arte.TextArea.prototype,d),$.extend($.Arte.constants.eventNames,{onbeforeundo:"onbeforeundo",onundo:"onundo",onbeforeredo:"onbeforeredo",onredo:"onredo"});var e=function(){return{init:function(a){a.undoInfo=a.undoInfo||{stack:[],index:-1},a.$element.on({onvaluechange:c})}}};a.register("undoManager",e)}($.Arte.pluginManager);
!function(a){var b=function(){var a={8:"BackSpace",13:"Enter",32:"Space",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",65:"A",66:"B",67:"C",73:"I",75:"K",85:"U",86:"V",88:"X"},b=function(){},c=function(b){var c=b.ctrlKey?"CTRL+":"";c+=b.altKey?"AlT+":"";var d=a[b.keyCode];return c+=d||""},d=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"CTRL+B":d.bold(),e.preventDefault();break;case"CTRL+I":d.italic(),e.preventDefault();break;case"CTRL+U":d.underline(),e.preventDefault();break;case"CTRL:A":case"CTRL+V":case"CTRL+ArrowDown":case"CTRL+ArrowLeft":case"CTRL+ArrowRight":case"CTRL+ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":setTimeout(function(){d.triggerEvent($.Arte.constants.eventNames.onselectionchange)},10)}},e=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"Enter":$.Arte.dom.convertDivsToP(d.$el)}};return{init:function(a){a.$element.on({onkeydown:d,onkeypress:b,onkeyup:e})}}};a.register("keyboardEventHandler",b)}($.Arte.pluginManager);
!function(a){$.Arte.configuration.pasteHandler={attributes:{id:1,style:1,"class":1},style:{font:1,"font-style":1,"font-weight":1,"font-family":1,color:1,"font-size":1,"text-align":1},tag:{P:1,DIV:1,UL:1,OL:1,LI:1,SPAN:1},nodeType:{1:1,3:1},invalidTagHandlers:{B:{applierTagName:"span",styleName:"font-weight",styleValue:"bold"},I:{applierTagName:"span",styleName:"font-style",styleValue:"italic"},U:{applierTagName:"span",styleName:"text-decoration",styleValue:"underline"},FONT:{applierTagName:"span"}}};var b=$.Arte.configuration.pasteHandler,c=$.Arte.configuration.classNameSpace,d=function(a){var d=a.get(0).nodeType;if(!b.nodeType[d])return a.remove(),null;if(d==$.Arte.constants.nodeType.TEXT){var e=a.get(0).nodeValue;return e=e.replace(/<!--[\S\s]*?-->/gi,""),""===e||!e.match(/\S+/gi)||e.match(/^[\xA0]+$/gi)?(a.remove(),null):(a.get(0).nodeValue=e.replace(/\n/gi,"").replace(/[\xA0|\s+]{2,}/gi," "),null)}var f=a.html();if(!f)return a.remove(),null;var g=a.prop("tagName");if(b.tag[g]){for(var h=a.prop("attributes"),i=0;i<h.length;i++)if(!b.attributes[h[i].name])try{a.removeAttr(h[i].name)}catch(j){}var k=$.Arte.dom.getClasses(a);$.each(k,function(b,d){0!==d.indexOf(c)&&a.removeClass(d)});var l="";return $.each($.Arte.dom.getStyles(a),function(a,c){var d=b.style[a];if(d)switch(a){case"font-size":d=c.match(/\d+\s?px/);break;case"color":d=c.match(/#[a-fA-F0-9]{6}/)||c.match(/rgb\(\d+,\s*\d+\,\s*\d+\)/)}d&&(l+=a+": "+c+"; ")}),a.get(0).style.cssText=l,null}var m=b.invalidTagHandlers[a.prop("tagName")]||{tagName:"DIV"},n=$.Arte.dom.createContainer(m).html(a.html());return n},e=function(a){a.each(function(){var a=$(this);e(a.contents());var b=d(a);b&&a.replaceWith(b)})};$.extend($.Arte.constants.eventNames,{onbeforehandlepaste:"onbeforehandlepaste",onhandlepaste:"onhandlepaste"});var f=function(){return{init:function(a){a.$element.on({onpaste:function(b,c){var d={execute:!0};a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d),d.execute&&(e(c.textArea.$el.children()),a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d))}})}}};a.register("pasteHandler",f)}($.Arte.pluginManager);